# Mimic-Red

![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.10+-green.svg)
![DrissionPage](https://img.shields.io/badge/DrissionPage-4.1.0+-orange.svg)
![Code Quality](https://img.shields.io/badge/code%20quality-optimized-brightgreen)

---

## 📖 项目简介

**Mimic-Red** 是一款针对小红书网页版的高性能、低风险数据采集工具。它通过接管真实浏览器并模拟人类行为，有效规避了常规反爬策略。

---

## 🛠️ 技术架构

| 模块 | 技术栈 | 说明 |
| :--- | :--- | :--- |
| **入口与调度** | `main.py` | 程序主入口，负责参数解析与任务调度 |
| **核心爬虫** | `xhs_utils/xhs_spider.py` | 封装了 `DrissionXHSSpider` 类，包含浏览器控制、数据提取、反爬策略等核心逻辑 |
| **浏览器控制** | `DrissionPage` | 基于 CDP 协议，比 Selenium/Playwright 更快、更隐蔽 |
| **数据提取** | `SSR + DOM` | 优先提取 `__INITIAL_STATE__` JSON 数据，智能 DOM 等待作为兜底 |
| **反爬对抗** | `Mimicry` | 真实浏览器接管 + 贝塞尔曲线鼠标轨迹 + 智能随机延迟 + Token脱敏 |
| **配置管理** | `selectors.json` | 支持动态配置 CSS 选择器，无需修改代码即可适配页面更新 |
| **数据存储** | `StorageManager` | 支持 SQLite/CSV/JSON/Excel 四种格式，自动去重 |

---

## 🚀 快速开始

### 1. 环境准备

确保已安装 Python 3.10+ 和 Google Chrome 浏览器。

```bash
# 克隆项目
git clone https://github.com/your-repo/Mimic-Red.git
cd Mimic-Red

# 安装依赖（推荐使用锁定版本）
pip install -r requirements-lock.txt

# 或使用最小版本约束（开发环境）
pip install -r requirements.txt
```

### 2. 启动 Chrome（调试模式）

你需要启动一个开启远程调试端口（9222）的 Chrome 浏览器，并手动登录小红书。

**Mac/Linux:**
```bash
chmod +x start_chrome.sh
./start_chrome.sh
```

**Windows:**
双击运行 `start_chrome.bat` 脚本即可。脚本会自动查找 Chrome 安装路径并开启调试端口。

> **⚠️ 重要**：启动后会自动打开小红书网站，请扫码登录。登录成功后，**不要关闭浏览器窗口**。

### 3. 运行爬虫

```bash
# 最简单用法（默认SQLite存储，爬取20条）
python main.py -k "悉尼咖啡"

# 推荐配置（每日限额100条，安全稳定）
python main.py -k "悉尼咖啡" -l 20 -d 100 -s sqlite

# 多关键词批量采集
python main.py \
  -k "悉尼大学" "墨尔本大学" "UNSW" \
  -l 30 -d 150 -s csv --min-likes 50

# 高质量内容精选
python main.py \
  -k "澳洲移民政策" \
  -l 50 --min-likes 500 -s excel
```

> 📖 **详细使用说明**：请查看 [使用说明.md](./使用说明.md) 了解更多参数和高级配置。

### 常用参数

| 参数 | 简写 | 说明 | 示例 |
|------|------|------|------|
| `--keywords` | `-k` | 关键词列表 | `-k "悉尼大学" "墨尔本"` |
| `--limit` | `-l` | 每个关键词数量 | `-l 50` |
| `--daily-limit` | `-d` | 每日总上限 | `-d 100` |
| `--storage` | `-s` | 存储格式 | `-s csv` |
| `--min-likes` | | 最少点赞数 | `--min-likes 100` |

完整参数列表和使用示例见 [使用说明.md](./使用说明.md)。

---

## 🛡️ 安全警告与法律合规（重要必读）

### ⚠️ 严正警告

**请勿尝试无限制的大规模爬取！**

小红书的反爬策略非常严格，本项目虽然使用了浏览器接管技术来降低特征，但**高频的访问行为**本身就是最大的特征。

### 安全配置建议

| 使用场景 | 每日上限 | 持续时间 | 风险等级 | 备注 |
|---------|---------|---------|---------|------|
| **新账号/测试期** | 50-100条/天 | 30-60分钟 | 🟢 低 | 建立信任基线 |
| **稳定运行期** | 100-150条/天 | 1-1.5小时 | 🟡 中 | **推荐配置** |
| **数据紧急需求** | 200-300条/天 | 2-2.5小时 | 🟠 高 | 需IP轮换+监控 |

**安全建议**：
*   **间隔设置**: 默认的智能随机延迟是经过测试的安全范围，**不要刻意缩短**。
*   **Token安全**: 日志中已自动对敏感 Token 进行了脱敏处理，但仍请妥善保管日志文件。
*   **时段建议**: 避开晚高峰（19:00-23:00）和午休时段（12:00-14:00），系统风控更严格。
*   **长期使用**: 建议每周至少休息1-2天，模拟真实用户行为。

### 技术检测机制（2026年）

小红书已部署多层反爬检测，本项目通过以下方式应对：

| 检测维度 | 小红书检测内容 | 本项目对策 |
|---------|---------------|-----------|
| **设备指纹** | IMEI、CPU频率、屏幕分辨率、已安装APP列表 | ✅ CDP接管真实浏览器，继承原生指纹 |
| **网络指纹** | TLS握手特征、HTTP/2请求头顺序、IP信誉评分 | ✅ 真实浏览器网络栈，⚠️ IP需用户自配 |
| **行为分析** | 鼠标轨迹完美度、滚动速度均匀性、点击时序 | ✅ 贝塞尔曲线鼠标+随机延迟 |
| **请求签名** | X-S、X-T、X-B3-Traceid等加密验证 | ✅ 浏览器自动生成签名 |

### 法律合规与风险（2026年中国法规）

#### 法律红线

| 行为 | 法律依据 | 刑事立案标准 | 处罚 |
|------|---------|-------------|------|
| 数据爬取 | 《刑法第285条》非法获取计算机信息系统数据罪 | 累计爬取 **> 100万条** | 💰 罚款 + 🔒 3-7年有期徒刑 |

#### 使用场景合规性

| 使用场景 | 合法性 | 风险等级 | 说明 |
|---------|--------|---------|------|
| 个人学习/学术研究 | ✅ 合法 | 🟢 低 | 不超过10万条，不盈利 |
| 商业数据分析（不盈利） | ⚠️ 灰色地带 | 🟡 中 | 需控制规模，避免用户隐私 |
| 数据转售/API服务 | ❌ 违法 | 🔴 极高 | 明确违法行为 |
| 累计爬取 > 100万条 | ❌ 刑事犯罪 | 🚫 刑事追诉 | 达到立案标准 |

#### 免责声明

1.  本项目仅供 **学习和研究** 使用，请勿用于商业用途。
2.  请遵守 [小红书用户协议](https://www.xiaohongshu.com/protocal/user) 和 [Robots协议](https://www.xiaohongshu.com/robots.txt)。
3.  使用者应对使用本项目产生的一切后果负责，**作者不承担任何法律责任**。
4.  如需大规模采集数据，请联系小红书官方获取商业授权 API。

#### 合规建议

*   ✅ 仅用于个人学习/学术研究
*   ✅ 控制总量 < 10万条
*   ❌ 不得用于商业盈利、数据转售
*   ❌ 不得爬取用户隐私数据（联系方式、精准位置等）

### 风险提示

**账号风险**: 过于频繁的请求会导致账号被暂时风控（无法查看详情、搜索无结果），严重时可能封号。

**IP风险**: 同一 IP 短时间内请求过多会触发验证码或直接 403。数据中心IP（云服务器）会被立即标记。

**可持续性**: 细水长流。本项目旨在辅助个人研究和小规模数据收集，而非商业级的大规模采集。

---

### Star History

如果这个项目对你有帮助，请给个 ⭐️ Star！

---
